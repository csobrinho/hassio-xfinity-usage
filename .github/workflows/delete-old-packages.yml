name: "Delete Old Packages"

on: 
  workflow_dispatch:
  #schedule:
    # * is a special character in YAML so you have to quote this string
    #- cron:  '0 0 * * 0' # Run Every Sunday

jobs:
  build:
    name: Delete Old Packages
    runs-on: ubuntu-latest
    permissions:
      contents: read
      packages: write
      id-token: write
    steps:      
    - name: Checkout the repository
      uses: actions/checkout@v4
          
    - name: Login to GitHub Container Registry
      uses: docker/login-action@v3.3.0
      with:
        registry: ghcr.io
        username: ${{ github.repository_owner }}
        password: ${{ secrets.GITHUB_TOKEN }}

    - name: Delete all untagged versions except latest 10
      uses: smartsquaregmbh/delete-old-packages@v0.8.1
      with:
        user: thor0215
        token: ${{ secrets.GITHUB_TOKEN }} 
        type: container
        names: |
          hassio-xfinity-usage-amd64
          hassio-xfinity-usage-aarch64
        version-pattern: ^0.0..+$
        keep: 2
        dry-run: true

